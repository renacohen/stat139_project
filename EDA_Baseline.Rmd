---
title: "EDA and Baseline Model"
author: "Chloe Shawah and Rena Cohen"
date: "11/15/2020"
output: pdf_document
---

```{r Load data, echo = FALSE}

clean_data_2 = readRDS("clean_data_2.rds")

```

### Exploratory Data Analysis

```{r Visualize Response Variable, out.width = '50%', out.height = '50%', echo = FALSE}

hist(clean_data_2$pct_mask,
     main = "Histogram of Mask-Wearing Score",
     xlab = "Mask-Wearing Score",
     ylab = "Number of Counties",
     col = "cornflowerblue")

```
```{r Density, out.width = '50%', out.height = '50%', echo = FALSE}

hist(clean_data_2$density,
     main = "Histogram of Density (untransformed)",
     xlab = "Density",
     ylab = "Number of Counties",
     col = "cornflowerblue")

hist(log(clean_data_2$density),
     main = "Histogram of log(Density)",
     xlab = "log(Density)",
     ylab = "Number of Counties",
     col = "cornflowerblue")

plot(pct_mask ~ log(density), data = clean_data_2,
        main = "Mask Wearing by log(Density)",
        xlab = "log(Density)",
        ylab = "Mask-Wearing Score",
        col = "cornflowerblue")

```


```{r RU Score, out.width = '50%', out.height = '50%', echo = FALSE}

hist(clean_data_2$ru_continuum,
     breaks = 1:10,
     ylim = c(0,900),
     xlim = c(1,10),
     main = "Histogram of Rural-Urban Continuum Score",
     xlab = "RU Score",
     ylab = "Number of Counties",
     col = "cornflowerblue")

boxplot(pct_mask ~ ru_continuum, data = clean_data_2,
        main = "Mask Wearing by Rural-Urban Continuum Score",
        xlab = "RU Score",
        ylab = "Mask-Wearing Score",
        col = "cornflowerblue")

```


```{r Percent College, out.width = '50%', out.height = '50%', echo = FALSE}

hist(clean_data_2$pct_college,
     main = "Histogram of Percent College Educated (untransformed)",
     xlab = "Percent College",
     ylab = "Number of Counties",
     col = "cornflowerblue")

hist(log(clean_data_2$pct_college),
     main = "Histogram of log(College)",
     xlab = "log(College)",
     ylab = "Number of Counties",
     col = "cornflowerblue")

plot(pct_mask ~ log(pct_college), data = clean_data_2,
        main = "Mask Wearing by log(College)",
        xlab = "log(College)",
        ylab = "Mask-Wearing Score",
        col = "cornflowerblue")

```


```{r Trump 2016, out.width = '50%', out.height = '50%', echo = FALSE}

hist(clean_data_2$pct_trump_2016,
     main = "Histogram of Percent Voted for Trump 2016 (untransformed)",
     xlab = "Percent Trump 2016",
     ylab = "Number of Counties",
     col = "cornflowerblue")

hist(log(100-clean_data_2$pct_trump_2016),
     main = "Histogram of log(100-Trump2016)",
     xlab = "log(100-trump2016)",
     ylab = "Number of Counties",
     col = "cornflowerblue")

plot(pct_mask ~ log(100-clean_data_2$pct_trump_2016), data = clean_data_2,
        main = "Mask Wearing by log(100-Trump2016)",
        xlab = "log(100-trump2016)",
        ylab = "Mask-Wearing Score",
        col = "cornflowerblue")

```


```{r, out.width = '50%', out.height = '50%', echo = FALSE}

hist((clean_data_2$pct_black + clean_data_2$pct_native + clean_data_2$pct_hispanic),
     main = "Histogram of Percent Minority (black, hispanic, native) (untransformed)",
     xlab = "Percent Minority",
     ylab = "Number of Counties",
     col = "cornflowerblue")

hist(log(clean_data_2$pct_black + clean_data_2$pct_native + clean_data_2$pct_hispanic),
     main = "Histogram of log(Minority)",
     xlab = "log(Minority)",
     ylab = "Number of Counties",
     col = "cornflowerblue")

plot(pct_mask ~ log(clean_data_2$pct_black + clean_data_2$pct_native + clean_data_2$pct_hispanic), 
     data = clean_data_2,
      main = "Mask Wearing by log(Minority)",
      xlab = "log(Minority)",
      ylab = "Mask-Wearing Score",
      col = "cornflowerblue")

```

``` {r Dem Governor, out.width = '50%', out.height = '50%', echo = FALSE}

boxplot(pct_mask ~ dem_governor, data = clean_data_2,
        main = "Mask Wearing by Democratic Governor",
        xlab = "Democratic Governor",
        ylab = "Mask-Wearing Score",
        col = "cornflowerblue")

```

``` {r Mandate, out.width = '50%', out.height = '50%', echo = FALSE}

boxplot(pct_mask ~ county_mandate, data = clean_data_2,
        main = "Mask Wearing by County Mandate",
        xlab = "County Mandate",
        ylab = "Mask-Wearing Score",
        col = "cornflowerblue")

boxplot(pct_mask ~ state_mandate, data = clean_data_2,
        main = "Mask Wearing by State Mandate",
        xlab = "County Mandate",
        ylab = "Mask-Wearing Score",
        col = "cornflowerblue")

```
Other variables that needed to be log transformed were `pct_seniors`, `pct_poverty`, and all individual race/ethnicity categories. `pct_hs` did not need to be log transformed, and `pct_female` looked skewed both with and without a transformation, so we left it untransformed.

We also have some missing variables in our dataset which we will have to figure out how to impute.

```{r NAs}

sapply(clean_data_2, function(x) sum(is.na(x)))

```


### Baseline Models

In order to run the linear model, we had to change some of the transformations to `log(1+X)` so avoid taking the log of 0. Specifically, we had to do this for all 4 race/ethnicity variables and `pct_college`. We left out two of the education categories to `pct_less_than_hs` and `pct_some_college` to avoid multicolinearity, but moving forward, it might be best to create two a variables that sums `pct_college` and `pct_some_college`. We might consider doing the same thing with minority groups. Finally, we removed `pct_trump2020` from the model because the multicolinearity between that and the 2016 percent was inflating the standard errors.


```{r Full Model, no Interactions}

interceptmodel = lm(pct_mask ~ 1, data = clean_data_2)

fullmodel = lm(pct_mask ~ pop_2019 + ru_continuum + log(density) + pct_hs + log(1+pct_college) +
               log(pct_poverty) + pct_female + log(1+pct_black) + log(1+pct_native) + log(1+pct_hispanic) +
               log(1+pct_asian) + log(pct_seniors) + log(100-pct_trump_2016) + dem_governor +
               state_mandate + county_mandate,
               data = clean_data_2)

summary(fullmodel)

interactionmodel = lm(pct_mask ~ (pop_2019 + ru_continuum + log(density) + pct_hs + log(1+pct_college) +
               log(pct_poverty) + pct_female + log(1+pct_black) + log(1+pct_native) + log(1+pct_hispanic) +
               log(1+pct_asian) + log(pct_seniors) + log(100-pct_trump_2016) + dem_governor +
               state_mandate + county_mandate)^2,
               data = clean_data_2)

selected_model = step(fullmodel, scope = list(lower = formula(interceptmodel), upper = formula(interactionmodel)), 
     direction = "both", trace = 0)

summary(selected_model)

```




